@startuml Business_Process_Sequence
!theme plain
skinparam backgroundColor #FEFEFE
skinparam sequenceActorBackgroundColor #F0F0F0

actor 学生
participant 前端
participant 后端
database Redis
database MySQL

学生 -> 前端: 点击座位预约
activate 前端
前端 -> 后端: POST /api/seat/reserve
activate 后端

后端 -> Redis: 获取分布式锁\n(seat:lock:{seatId})
activate Redis
Redis --> 后端: 锁获取成功
deactivate Redis

后端 -> MySQL: 查询座位状态
activate MySQL
MySQL --> 后端: 座位未被预约
deactivate MySQL

后端 -> MySQL: 保存预约记录
activate MySQL
MySQL --> 后端: 保存成功
deactivate MySQL

后端 -> Redis: 释放分布式锁
activate Redis
Redis --> 后端: 锁释放成功
deactivate Redis

后端 -> 前端: 返回预约成功
deactivate 后端

前端 -> 前端: 通过WebSocket\n接收座位更新
前端 -> 学生: 显示座位已预约
deactivate 前端

@enduml
