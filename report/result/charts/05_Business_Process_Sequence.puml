@startuml Seat Reservation Sequence
!theme plain
skinparam backgroundColor #FFFFFF

title Zen Campus - Seat Reservation Sequence

actor Student
participant Frontend
participant SeatStatusController
participant SeatReservationService
participant Redis
participant MySQL
participant WebSocket
participant MessageService

Student -> Frontend: select seat
Frontend -> SeatStatusController: mark pending
SeatStatusController -> SeatReservationService: markSeatPending
SeatReservationService -> Redis: set seat:pending:* TTL 30s
SeatReservationService -> WebSocket: broadcast PENDING

Student -> Frontend: confirm reservation
Frontend -> SeatReservationService: reserve seat
SeatReservationService -> Redis: tryLock lock:seat:*
alt lock acquired
  SeatReservationService -> MySQL: check overlap
  alt no conflict
    SeatReservationService -> MySQL: insert seat_reservation
    SeatReservationService -> WebSocket: broadcast RESERVED
    SeatReservationService -> MessageService: send template message
  else conflict
    SeatReservationService --> Frontend: conflict error
  end
  SeatReservationService -> Redis: unlock
else lock failed
  SeatReservationService --> Frontend: retry later
end

@enduml
